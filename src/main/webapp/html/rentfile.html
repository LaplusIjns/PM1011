<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="../bootstrap5/css/bootstrap.css" rel="stylesheet">
    <link href="../css/manager.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- <link href="../css/index.css" rel="stylesheet"> -->
    <script src="../bootstrap5/js/bootstrap.js"></script>
    <script src="../js/jquery.js"></script>
    <script src="../js/logIn.js"></script>
    <!--     <script src = "../js/profiles.js"></script>  -->
    <style>
        .rating-color {
            color: orange;
        }
    </style>
    <title>Document</title>

</head>

<body>
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-11">
                <!-- top-navbar navbar navbar-expand-sm navbar-dark bg-dark -->
                <nav class="navbar navbar-expand bg-info text-white">
                    <div class="container-fluid">
                        <a class="navbar-brand" href="../index.html">
                            <img src="../img/LOGO03.png" style="height:50px; width:auto;">
                        </a>
                        <ul class="nav nav-pills me-auto te mx-1">
                            <!-- nav nav-pills -->
                            <!-- data-bs-toggle="pill" -->
                            <li class="nav-item">
                                <a class="nav-link text-white fs-4"  href="../index.html">首頁</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link text-white fs-4" href="./rentflow.html">租借流程</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link text-white fs-4" href="./chat.html">聊天室</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link text-white fs-4" href="./wishpool.html">許願池</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link text-white  fs-4"  href="./member.html">會員</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link text-white fs-4" href="./cart.html">購物車</a>
                            </li>
                        </ul>
                        <!-- 靠右 -->
                        <div class="d-flex">
                            <div class="btn-group" role="group">
                                <!-- 第一顆按鈕 -->
                                <button id="loginBtn" type="button" class="btn btn-primary fs-4" data-bs-toggle="modal"
                                    data-bs-target="#staticBackdrop">登入</button>
                                <button id="logoutBtn" type="submit" style="display:none" class="btn btn-primary fs-4"
                                    data-bs-target="#staticBackdrop">登出</button>
                                <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static"
                                    data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel"
                                    aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title text-dark" id="staticBackdropLabel">登入</h5>
                                                <button type="button" class="btn-close fs-4" data-bs-dismiss="modal"
                                                    aria-label="Close"></button>
                                            </div>
                                            <form class="text-dark">
                                                <div class="modal-body" id="loginBox">
                                                    <label class="mx-2 my-1">帳號</label>
                                                    <input class="mx-2 my-1" type="text" id="loginAccountTextBox"
                                                        placeholder="請輸入大小寫英數字"><br>
                                                    <label class="mx-2 my-1">密碼 </label>
                                                    <input class="mx-2 my-1" type="password" id="loginPasswordMTextBox"
                                                        placeholder="請輸入大小寫英數字"><br>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn" id="forgetBtn fs-4">忘記密碼？</button>
                                                    <button type="button" class="btn btn-secondary fs-4"
                                                        data-bs-dismiss="modal">關閉</button>
                                                    <button type="button" id="loginMember" class="btn btn-primary fs-4"
                                                        data-bs-dismiss="modal">送出</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <!-- 第二顆按鈕 -->
                                <button id="createBtn" type="button" class="btn btn-primary fs-4" data-bs-toggle="modal"
                                    data-bs-target="#staticBackdrop2">註冊</button>
                                <div class="modal fade" id="staticBackdrop2" data-bs-backdrop="static"
                                    data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel2"
                                    aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title text-dark" id="staticBackdropLabel2">註冊</h5>
                                                <button type="button" class="btn-close fs-4" data-bs-dismiss="modal"
                                                    aria-label="Close"></button>
                                            </div>

                                            <form class="text-dark">
                                                <div class="modal-body">
                                                    <label class="mx-2 my-1">帳號</label>
                                                    <input class="mx-2 my-1" type="text" id="createAccountTextBox"
                                                        placeholder="請輸入大小寫英數字"><br>
                                                    <label class="mx-2 my-1">密碼</label>
                                                    <input class="mx-2 my-1" type="password" id="createPasswordMTextBox"
                                                        placeholder="請輸入大小寫英數字"><br>
                                                    <label class="mx-2 my-1">信箱</label>
                                                    <input class="mx-2 my-1" type="text" id="createMailTextBox"
                                                        placeholder=""><br>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary fs-4"
                                                        data-bs-dismiss="modal">關閉</button>
                                                    <button type="button" id="createMember" class="btn btn-primary fs-4"
                                                        data-bs-dismiss="modal">送出</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
 
            </nav>
            <!-- main-body -->
            <div class="row justify-content-center">
                <!-- 左側導覽列 -->
                <div class="col-2 ">

                </div>

                <!-- 標籤內容 -->
                <div class="col-9 ">
                    <div class="row justify-content-center">
                        <!-- 會員資料 -->
                        <div class="col-6">
                            <div class="mx-1 my-3 px-2 py-3" id="myTab">
                                <div class="card">
                                    <div class="card-body text-dark text-center">
                                        <img id="headPhoto"
                                            src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava2-bg.webp"
                                            class="rounded-circle img-fluid" style="width: 100px;" />
                                        <h4 class="my-2" id="member_nickname"></h4>
                                        <p id="member_region"></p>
                                        <p id="member_introduction"></p>
                                        <p></p>

                                        <button type="button" class="btn btn-primary btn-rounded btn-lg" id="contactposter">
                                            傳訊息
                                        </button>
                                        <!-- <button id="editbtn" type="button" class="btn btn-primary btn-rounded btn-lg"
                                            data-bs-toggle="modal" data-bs-target="#editmodal">
                                            編輯
                                        </button> -->
                                    </div>
                                </div>
                            </div>
                        </div>
<!--                         評價  -->
                        <div class="col-6">
                            <div class="mx-1 my-3 px-2 py-3" id="myRate">
<!--                                 單一評價 -->
<!--                                 <div class="card my-1"> -->
<!--                                     <div class="card-body text-dark d-flex justify-content-between"> -->
<!--                                         <img class="img-fluid rounded-3" style="height:25px;width:auto;" -->
<!--                                             src="https://mdbootstrap.com/img/Photos/Horizontal/E-commerce/Products/3.webp"> -->
<!--                                         <span>評價ID</span> -->
<!--                                         <span>簡述</span> -->
<!--                                         <div class="ratings"> -->
<!--                                             <i class="fa fa-star rating-color"></i> -->
<!--                                             <i class="fa fa-star rating-color"></i> -->
<!--                                             <i class="fa fa-star rating-color"></i> -->
<!--                                             <i class="fa fa-star rating-color"></i> -->
<!--                                             <i class="fa fa-star rating-color"></i> -->
<!--                                         </div> -->
<!--                                     </div> -->
<!--                                 </div> -->
<!--                                 單一評價結束 -->
<!--                                 單一評價 -->
<!--                                 <div class="card my-1"> -->
<!--                                     <div class="card-body text-dark d-flex justify-content-between"> -->
<!--                                         <img class="img-fluid rounded-3" style="height:25px;width:auto;" -->
<!--                                             src="https://mdbootstrap.com/img/Photos/Horizontal/E-commerce/Products/3.webp"> -->
<!--                                         <span>評價ID</span> -->
<!--                                         <span>簡述</span> -->
<!--                                         <div class="ratings"> -->
<!--                                             <i class="fa fa-star rating-color"></i> -->
<!--                                             <i class="fa fa-star rating-color"></i> -->
<!--                                             <i class="fa fa-star rating-color"></i> -->
<!--                                             <i class="fa fa-star rating-color"></i> -->
<!--                                             <i class="fa fa-star"></i> -->
<!--                                         </div> -->
<!--                                     </div> -->
<!--                                 </div> -->
                                <!-- 單一評價結束 -->

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 跳出編輯室窗 -->
            <div class="modal top fade" id="editmodal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">

                            <h4 class="modal-title">編輯個人資料</h4>
                            <button type="close" class="btn btn-close text-white" data-bs-dismiss="modal"
                                aria-label="Close"></button>

                        </div>
                        <div class="modal-body">
                            <form method="post" class="test" action="http://localhost:8080/changeRegister"
                                enctype="Multipart/Form-Data" target="nm_iframe">
                                <!-- <div class="mx-3 my-3"> -->
                                <div class="my-2">
                                    <label class="form-label">暱稱　:　</label>
                                    <input class="form-text" type="text" name="member_nickname" value="">
                                </div>
                                <div class="my-2">
                                    <label class="form-label">居住地:　</label>
                                    <input class="form-text" type="text" name="member_region" value="">
                                </div>
                                <div>
                                    <label class="form-label">自我簡介</label>
                                    <textarea class="form-control" name="member_introduction"></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="formFile" class="form-label">上傳頭像</label>
                                    <input class="form-control" type="file" id="formFile" name="uploadImg">
                                </div>
                                <div class="mb-3">
                                    <label for="formFile" class="form-label">生日</label>
                                    <input class="form-control" type="date" id="productdate" name="member_birthday"
                                        value="">
                                </div>
                                <!-- </div> -->

                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary" data-bs-dismiss="modal" id="formBtn">確定</button>
                            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">取消</button>
                            </form>
                            <iframe id="id_iframe" name="nm_iframe" style="display:none;"></iframe>
                        </div>
                    </div>
                </div>
            </div>

            <!-- foot -->
            <a href="javascript:window.scrollTo(0,0)">
                <footer class="footer bg-secondary text-center text-white mt-auto fixed-bottom">
                    <div class="container-fluid">
                        <span class="">2022 EEIT48 </span>
                    </div>
                </footer>
            </a>

        </div>
    </div>
    </div>
    <!-- function 區域 -->
    <!-- <script src="../js/profiles.js"></script> -->
    <script>
        function creatchatroom(poster,viewer){
            return $.ajax({
                url:"/api/chat/creatchatroom/"+poster+"/"+viewer,
                type:"PUT",
                async:!1,
                success:function(res){},
                error:function(err){console.log(err)},
                });
        }
        function AjaxgetRegister() {
            return $.ajax({
                type: "get",
                url: "/getRegister",
                async: !1,
                success: function(res) {
                    //			console.log(res["member_nickname"])
                },
                error: function(err) { console.log(err) },
            })
        }
        function AjaxgetFindAccount(account) {
	        return $.ajax({
		        type: "POST",
		        url: "/findmember_account/"+account,
		        async: !1,
		        success: function(res) {
						console.log(res)
		    },
		        error: function(err) { console.log(err) },
	        })
        }
        function getaccount(){
            var urlstring = location.href
            var url = new URL(urlstring)
            return url.searchParams.get('account') 
        }
        function getaccountfile(account){
            if(account==null){
            // 跳轉
        }else{
            var result = AjaxgetFindAccount(account)
            if(result["status"]==404){
                //跳轉
            }
            return result["responseJSON"]["0"]
        }}
        function AjaxgetRate2(accountid) {
	        return $.ajax({
                type: "post",
                url: "/getRate/"+accountid,
                //            dataType:"json",
                async: !1,
                success: function(res) { },
                error: function(err) { console.log(err) },
	    })}
        function rateUI(accountid) {
            var p = AjaxgetRate2(accountid)
            rateData = p;
            $("#myRate").text("")
            console.log(rateData)
            if(rateData["responseText"]!=""){
                if(rateData["responseJSON"]["linkedListmembers"].length==0){
                    $("#myRate").text("暫無資料")
                }
                for (let i = 0; i < rateData["responseJSON"]["linkedListmembers"].length; i++) {
                    if(rateData["responseJSON"]["listrate_list"][i]["rate_description"]==null){
                        rateData["responseJSON"]["listrate_list"][i]["rate_description"]="無評論"
                    }
                    $liTemplate = '<div class="card my-1">'
                    $liTemplate +=
                        '<div class="card-body text-dark d-flex justify-content-between">'
                        + '<span class="text-primary">' + rateData["responseJSON"]["linkedListitems"][i]["item_name"] + '</span>'
                        + '<span>' + rateData["responseJSON"]["linkedListmembers"][i]["member_account"] + '</span>'
                        + '<span>' + rateData["responseJSON"]["listrate_list"][i]["rate_description"] + '</span>'
                        + '<div class="ratings">'
                    for (let j = 0; j < rateData["responseJSON"]["listrate_list"][i]["rate_grade"]; j++) {
                        $liTemplate += '<i class="fa fa-star rating-color"></i>';
                    }
                    for (let k = 0; k < (5 - rateData["responseJSON"]["listrate_list"][i]["rate_grade"]); k++) {
                        $liTemplate += '<i class="fa fa-star"></i>';
                    }
                    $liTemplate += '</div></div></div>'
                    jq = $($liTemplate)
                    jq.appendTo("#myRate")
                }}
            }
        viewer = AjaxgetRegister()["responseJSON"]["member_id"]
        account = getaccount()
        accountfile = getaccountfile(account)
        accountrank = AjaxgetRate2(accountfile["member_id"])
        poster = accountfile["member_id"]
        rateUI(accountfile["member_id"])
        // console.log(accountfile)
        // console.log(accountrank)
        $("#member_nickname").text(accountfile["member_nickname"]);
		$("#member_region").text(accountfile["member_region"]);
		$("#member_introduction").text(accountfile["member_introduction"]);
        if (accountfile["member_icon"] != null) {
			$("#headPhoto").attr("src", "../img/" + accountfile["member_icon"]);
		}
        $("#contactposter").click(function () {
            console.log(poster+" "+viewer)
            if(viewer!=0){
            var p = creatchatroom(poster,viewer)
            console.log(p)
            // window.location.href="chat.html";
            window.open("chat.html");
            }else{
                alert("請先登入")
            }
            
        })



    </script>
    <!--   <script src = "../js/profiles_old.js"></script> -->
</body>

</html>